<html>
    <title>Code online | Run code online</title>
    <head>
        <link rel="stylesheet" href="index.css">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        
    </head>

    <body>
        
        <header>
        <div id='header-container'>

            <div id='headericon-container'><img src="codeonlineicon.png" id='headericon'></div><div id='heading-container' class='jumbotron'><h1 id='heading'>Code Online</h1></div>
            
        </div>
        </header>

        

        <div id='main-container'>
            <div id='editor'></div>
            <div id='runbtn-container'>
                <button id='run-button' onclick="clicked()">RUN</button>
            </div>
            <div id='terminal-container'><canvas id='terminal' tabindex="0"></canvas></div> 
        </div>

        <script src="ace/src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
        <script src="terminal.js" type="text/javascript"></script>
        <script>
            var editor = ace.edit("editor");
            editor.setTheme("ace/theme/monokai");
            editor.session.setMode("ace/mode/python");
            
        </script>

        <script src="keyboard.js" type="text/javascript"></script>

        <script>
            var ws;
            function clicked(){
                t.setWriteLock(false);
                ws=new WebSocket("ws://localhost:8888");
                ws.addEventListener('open', function (event) {
                        ws.send("py--"+editor.getValue());
                        t.clearScreen();
                });

                ws.addEventListener('close', function (event) {
                        t.nextLine();
                        t.writeText("Your program is exited");
                        t.setWriteLock(true);
                });

                ws.addEventListener('message',function (event) {
                       t.writeText(event.data);
                });
            }
        </script>

<script>
    var t=new Terminal('terminal',25);

    function onKeyPress(keyname){
        if(keyname=='Backspace'){
            t.removeFromBuffer();
        }
        else if(keyname=='Enter'){           
            ws.send(t.getBuffer());
            t.nextLine();
            t.setBuffer();
        }
        else{
        t.writeTextOnBuffer(keyname);
        }
    }

    var keyboard=new Keyboard('terminal');
    keyboard.registerKeyDownCallback(onKeyPress);
</script>


    </body>
</html>